{
"AWSTemplateFormatVersion": "2010-09-09",
"Description": "AWS CloudFormation template to create a VPC with 3 subnets (1 public, 2 private), a public EC2 instance, and an RDS DB instance in private subnets.",
"Resources": {
"MyVPC": {
"Type": "AWS::EC2::VPC",
"Properties": {
"CidrBlock": "10.0.0.0/16",
"EnableDnsSupport": "true",
"EnableDnsHostnames": "true"
}
},
"InternetGateway": {
"Type": "AWS::EC2::InternetGateway"
},
"GatewayAttachment": {
"Type": "AWS::EC2::VPCGatewayAttachment",
"Properties": {
"VpcId": {
"Ref": "MyVPC"
},
"InternetGatewayId": {
"Ref": "InternetGateway"
}
}
},
"PublicSubnet": {
"Type": "AWS::EC2::Subnet",
"Properties": {
"VpcId": {
"Ref": "MyVPC"
},
"CidrBlock": "10.0.1.0/24",
"MapPublicIpOnLaunch": "true",
"AvailabilityZone": {
"Fn::Select": [
"0",
{
"Fn::GetAZs": ""
}
]
}
}
},
"PrivateSubnetOne": {
"Type": "AWS::EC2::Subnet",
"Properties": {
"VpcId": {
"Ref": "MyVPC"
},
"CidrBlock": "10.0.2.0/24",
"AvailabilityZone": {
"Fn::Select": [
"1",
{
"Fn::GetAZs": ""
}
]
}
}
},
"PrivateSubnetTwo": {
"Type": "AWS::EC2::Subnet",
"Properties": {
"VpcId": {
"Ref": "MyVPC"
},
"CidrBlock": "10.0.3.0/24",
"AvailabilityZone": {
"Fn::Select": [
"2",
{
"Fn::GetAZs": ""
}
]
}
}
},
"PublicRouteTable": {
"Type": "AWS::EC2::RouteTable",
"Properties": {
"VpcId": {
"Ref": "MyVPC"
}
}
},
"PublicRoute": {
"Type": "AWS::EC2::Route",
"Properties": {
"RouteTableId": {
"Ref": "PublicRouteTable"
},
"DestinationCidrBlock": "0.0.0.0/0",
"GatewayId": {
"Ref": "InternetGateway"
}
}
},
"PublicSubnetRouteTableAssociation": {
"Type": "AWS::EC2::SubnetRouteTableAssociation",
"Properties": {
"SubnetId": {
"Ref": "PublicSubnet"
},
"RouteTableId": {
"Ref": "PublicRouteTable"
}
}
},
"EC2Instance": {
"Type": "AWS::EC2::Instance",
"Properties": {
"InstanceType": "t2.micro",
"ImageId": "ami-0c55b159cbfafe1f0",
"SubnetId": {
"Ref": "PublicSubnet"
},
"KeyName": "Kubernetespem",
"SecurityGroupIds": [
{
"Ref": "PublicSG"
}
]
}
},
"PublicSG": {
"Type": "AWS::EC2::SecurityGroup",
"Properties": {
"GroupName": "public-sg",
"VpcId": {
"Ref": "MyVPC"
},
"SecurityGroupIngress": [
{
"IpProtocol": "tcp",
"FromPort": 22,
"ToPort": 22,
"CidrIp": "0.0.0.0/0"
}
],
"SecurityGroupEgress": [
{
"IpProtocol": "-1",
"FromPort": 0,
"ToPort": 65535,
"CidrIp": "0.0.0.0/0"
}
]
}
},
"RdsDBInstance": {
"Type": "AWS::RDS::DBInstance",
"Properties": {
"DBInstanceClass": "db.t2.micro",
"AllocatedStorage": 20,
"DBName": "MyDatabase",
"Engine": "mysql",
"MasterUsername": "dbadmin",
"MasterUserPassword": "Mounika%9573",
"DBSubnetGroupName": {
"Ref": "MyDBSubnetGroup"
},
"VPCSecurityGroups": [
{
"Ref": "PrivateSG"
}
]
}
},
"MyDBSubnetGroup": {
"Type": "AWS::RDS::DBSubnetGroup",
"Properties": {
"DBSubnetGroupDescription": "A DBSubnetGroup",
"SubnetIds": [
{
"Ref": "PrivateSubnetOne"
},
{
"Ref": "PrivateSubnetTwo"
}
]
}
},
"PrivateSG": {
"Type": "AWS::EC2::SecurityGroup",
"Properties": {
"GroupName": "private-sg",
"VpcId": {
"Ref": "MyVPC"
},
"SecurityGroupIngress": [
{
"IpProtocol": "tcp",
"FromPort": 3306,
"ToPort": 3306,
"SourceSecurityGroupId": {
"Ref": "PublicSG"
}
}
],
"SecurityGroupEgress": [
{
"IpProtocol": "-1",
"FromPort": 0,
"ToPort": 65535,
"CidrIp": "0.0.0.0/0"
}
]
}
}
}
}
